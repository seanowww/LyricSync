<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>LyricSync â€“ Prototype</title>
  </head>
  <body>
    <h1>LyricSync</h1>
    <p>Upload a singing video or audio file to generate timing segments.</p>

    <!-- 1. File input: this is what prompts the user -->
    <input
      type="file"
      id="file-input"
      accept="audio/*,video/*"
    />

    <!-- 2. Button to start upload -->
    <button id="upload-btn">Upload & Transcribe</button>

    <!-- 3. Place to show status + results -->
    <p id="status"></p>
    <pre id="results"></pre>

    <script>
      const fileInput = document.getElementById("file-input");
      const uploadBtn = document.getElementById("upload-btn");
      const statusEl = document.getElementById("status");
      const resultsEl = document.getElementById("results");

      uploadBtn.addEventListener("click", async () => {
        // --- Guard: make sure user selected a file ---
        const file = fileInput.files[0];
        if (!file) {
          alert("Please choose a video or audio file first.");
          return;
        }

        statusEl.textContent = "Uploading and processing...";
        resultsEl.textContent = "";

        // --- Build the form data to send to FastAPI ---
        const formData = new FormData();
        // "file" must match the parameter name in your FastAPI route
        formData.append("file", file);

        try {
          const response = await fetch("/api/transcribe", {
            method: "POST",
            body: formData,
          });

        if (!response.ok) {
          const msg = await response.text().catch(() => response.statusText);
          statusEl.textContent = `Server error (${response.status}): ${msg}`;
          return;
        }

        const data = await response.json();
        const videoId = data.video_id;

        if (!videoId) {
          statusEl.textContent = "Unexpected response: missing video_id";
          return;
        }

        statusEl.textContent = "Upload complete. Redirecting to preview...";

        window.location.href = `/preview?video_id=${encodeURIComponent(videoId)}`;
        return;

      } catch (err) {
        statusEl.textContent = "Request failed: " + err.message;
      }
      });
    </script>
  </body>
</html>
